{if $smarty.request.action eq 'add'}
{assign var=title value="Add Event"}
{else}
{assign var=title value="Edit Event"}
{/if}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>{$title}</title>
    <link rel="stylesheet" type="text/css" href="{$config.root_surl}/templates/css/admin.css" />

<script type="text/javascript" src="js/tiny_mce/tiny_mce.js"></script>


<script language="javascript" type="text/javascript">
tinyMCE.init({
	// General options
	mode : "exact",
	elements: "htmleditor",
	theme : "advanced",
	plugins : "safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",

	// Theme options
	theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
	theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
	theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
	theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak",
	theme_advanced_toolbar_location : "top",
	theme_advanced_toolbar_align : "left",
	theme_advanced_statusbar_location : "bottom",
	theme_advanced_resizing : true,

	// Drop lists for link/image/media/template dialogs
	template_external_list_url : "lists/template_list.js",
	external_link_list_url : "lists/link_list.js",
	external_image_list_url : "lists/image_list.js",
	media_external_list_url : "lists/media_list.js",

});
  function addToForm(name, title){
    el = document.getElementById('fieldsList');
	el.value = el.value + name + "\n";   
  	return false;
  }
    
</script>
<style>
    ul { list-style: none; }
    .ui-selected { background: #727EA3; color: #FFF; }
    .ui-selecting { border: 1px solid #AAA; }
    li { background: #CFD4E6; width: 200px; margin: 5px; font-size: 10px; font-family: Arial; padding: 3px; }    
</style>


</head>
<body bgcolor="white" style="leftmargin:0px; rightmargin:0px; topmargin:0px;">
<center>
<br /><h3>{$title}</h3>


<a name="e">&nbsp;</a>
{if $error}
<table><tr><td>
{foreach from=$error item=e}
<li><font color=red><b>{$e}</b></font>
{/foreach}
</td></tr></table>
{/if}


{php}
$this->assign('enabled_disabled', array('' => 'Enabled', '1' => 'Disabled'));
$this->assign('no_yes', array('' => 'No', '1' => 'Yes'));
{/php}
<form method=post>
<table class=vedit>
<tr>
	<th><b>Title *</b></th>
	<td><input type="text" name="title" value="{$p.title|escape}" size=30></td>	
</tr>
<tr>
	<th><b>Start Date *</b></th>
	<td>{html_select_date prefix="start_date" time=$p.start_date end_year="2037"}</td>	
</tr>
<tr>
	<th><b>End Date *</b></th>
	<td>{html_select_date prefix="expire_days" time=$p.expire_days end_year="2037"}</td>	
</tr>
<tr>
	<th><b>Time</b></th>
	<td><input type="text" name="event_time" value="{$p.event_time|escape}" size=15></td>	
</tr>
<tr>
	<th><b>Location</b></th>
	<td><input type="text" name="event_location" value="{$p.event_location|escape}" size=30></td>	
</tr>
<tr>
	<th><b>Online Registration</b></th>
	<td>
	{html_radios name=event_registration_disabled options=$enabled_disabled selected=$p.event_registration_disabled}
	</td>	
</tr>
<tr>
	<th><b>Price *</b></th>
	<td><input type="text" name="price" value="{$p.price|escape}" size=10></td>	
	</td>	
</tr>
<tr>
	<th><b>Instant Payment Required</b></th>
	<td>{html_radios options=$no_yes name="event_instant_payment_only" selected=$p.event_instant_payment_only}</td>	
	</td>	
</tr>
<tr>
	<th><b>Attendees limit</b><br />
    <small>please enter nax. number<br />
    of subscribers for this event or<br />
    keep this field empty
    </th>
	<td><input type="text" name="event_subscribers_limit" value="{$p.event_subscribers_limit|escape}"></td>	
	</td>	
</tr>
<tr>
	<th><b>Define Special Prices</b>
    </th>
	<td>
    {php}
        $this->assign('ii', range(0,9));
        $pl = $GLOBALS['db']->get_products_list();
        $pl1 = array('' => '*********');
        foreach ($pl as $k => $v) 
            if ($v['is_event']) unset($pl[$k]);
            else $pl1[ $v['product_id'] ] = $v['title'];
        $this->assign('sp_products', $pl1);
    {/php}
    {foreach from=$ii item=i}
    <select name='special_price[{$i}][0]'>{html_options options=$sp_products selected=$p.special_price.$i.0}</select>
    <input type=text name="special_price[{$i}][1]" value="{$p.special_price[$i][1]}" size=10>
    <br />        
    {/foreach}
    </td>	
	</td>	
</tr>

<tr>
<td colspan=2>
<b>Event Description</b><br />
<textarea name="description" cols=70 rows=20 class="mceEditor" id="htmleditor">
{$p.description|escape:"html"}
</textarea>
</td>
</tr>

<tr>
<th>Event-Specific Fields</th>
<td>
<small>Please specify fields that are NOT usually asked during 
signup process, but necessary for this event</small>

<table width="100%"><tr><td width=50% valign="top">

<ul id="fieldsListAll" >
{foreach from=$fields item=f}
<li>{$f.name} ({$f.title}) <a href="#" onclick="return addToForm('{$f.name|escape:"javascript"}', '{$f.title|escape:"javascript"}') && 0">Add</a></li>
{/foreach}
</ui>
</td><td valign="top">

<textarea id="fieldsList" name="event_fields" cols="40" rows="10">{$p.event_fields|escape:"html"}</textarea>

</td></tr></table>


</td>
</tr>


</table>
<br />
<input type=submit value="Save" />
<input type=hidden name="action" value="{$smarty.request.action}" />
<input type=hidden name="save" value="1" />
<input type=hidden name="product_id" value="{$p.product_id|escape}" />

</form>

<br />

{include file="admin/footer.inc.html"}

